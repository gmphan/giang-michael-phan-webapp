@model ProjectView
@{
    ViewData["Title"] = "Project Detail";
    var projectMain = Model;
    var tasks = Model.ProjectTasks;
    @* var activities = Model.ProjectTaskActivities; *@
}
<div class="row justify-content-center">
    <div class="col-lg-10 col-md-12">
        <h1 class="card-header">Project Details</h1>
        <div>
            @Html.Partial("_ProjectDetailTopLayer", projectMain)
        </div>
        <div>
            @Html.Partial("_ProjectDetailTasks", Model)
        </div>
    </div>
</div>


<!-- JavaScript to handle task selection and update activities -->
@section Scripts{
    <script>
        document.getElementById('taskSelect').addEventListener('change', function () {
            var selectedOption = this.options[this.selectedIndex];

            if (selectedOption.value) {
                // Show the task details section
                document.getElementById('taskDetails').style.display = 'block';

                // Update task details
                document.getElementById('taskName').textContent = selectedOption.getAttribute('data-task-name');
                document.getElementById('taskDescription').textContent = selectedOption.getAttribute('data-task-description');
                document.getElementById('taskState').textContent = selectedOption.getAttribute('data-task-state');
                document.getElementById('startDate').textContent = selectedOption.getAttribute('data-start-date');
                document.getElementById('dueDate').textContent = selectedOption.getAttribute('data-due-date');
                document.getElementById('completedDate').textContent = selectedOption.getAttribute('data-completed-date');

                
                // Retrieve the JSON from the hidden script tag
                var activitiesScript = document.getElementById('task-activities-' + selectedOption.value);
                var activities = JSON.parse(activitiesScript.textContent);
                var activitiesList = document.getElementById('activitiesList');
                activitiesList.innerHTML = ''; // Clear previous activities

                activities.forEach(function(activity) {
                    var listItem = document.createElement('li');
                    listItem.className = 'list-group-item';
                    listItem.textContent = activity.ActivityNote + ' - ' + activity.CreatedDate;
                    activitiesList.appendChild(listItem);
                });
            } else {
                // Hide the task details if no task is selected
                document.getElementById('taskDetails').style.display = 'none';
            }
        });
    </script>
}
