@model Project3LayerView

<div class="card-body">
    <div class="card mb-3">
        <form method="post" action="/YourController/YourAction">
            <div class="p-1 mt-2">
                <div class="row mb-1 p-0">
                    <div class="d-flex align-items-center">
                        <label asp-for="SelectedTaskId" class="me-2" style="min-width: 150px;">Tasks</label>
                        <select asp-for="SelectedTaskId" class="form-select form-control flex-grow-1" id="taskDropdown">
                            <option value="">---Select a task---</option>
                            @foreach (var task in Model.ProjectTasks)
                            {
                                <option value="@task.Id"
                                        data-description="@task.ProjectTaskDescription"
                                        data-state="@task.ProjectTaskState"
                                        data-start-date="@task.ProjectTaskStartDate"
                                        data-due-date="@task.ProjectTaskDueDate"
                                        data-completed-date="@task.ProjectTaskCompletedDate"
                                        data-activities="@System.Text.Json.JsonSerializer.Serialize(task.ProjectTaskActivities.Select(a => a.ActivityNote ?? "No Activity Note").ToList())">
                                    @task.ProjectTaskName
                                </option>
                            }
                        </select>
                    </div>
                </div>

                <!-- Task Description -->
                <div class="p-1 mt-2">
                    <div class="row mb-1 p-0">
                        <div class="d-flex align-items-center">
                            <label for="taskDescription" class="me-2" style="min-width: 150px;">Task Description</label>
                            <input id="taskDescription" class="form-control flex-grow-1" placeholder="Task Description" type="text" readonly>
                        </div>
                    </div>
                </div>

                <!-- Task State -->
                <div class="p-1 mt-2">
                    <div class="row mb-1 p-0">
                        <div class="d-flex align-items-center">
                            <label for="taskState" class="me-2" style="min-width: 150px;">Task State</label>
                            <input id="taskState" class="form-control flex-grow-1" placeholder="Task State" type="text" readonly>
                        </div>
                    </div>
                </div>

                <!-- Additional Task Fields: Start Date, Due Date, Completed Date -->
                <div class="p-1 mt-2">
                    <div class="row mb-1 p-0">
                        <div class="d-flex align-items-center">
                            <label for="taskStartDate" class="me-2" style="min-width: 150px;">Start Date</label>
                            <input id="taskStartDate" class="form-control flex-grow-1" placeholder="Start Date" type="text" readonly>
                        </div>
                    </div>
                    <div class="row mb-1 p-0">
                        <div class="d-flex align-items-center">
                            <label for="taskDueDate" class="me-2" style="min-width: 150px;">Due Date</label>
                            <input id="taskDueDate" class="form-control flex-grow-1" placeholder="Due Date" type="text" readonly>
                        </div>
                    </div>
                    <div class="row mb-1 p-0">
                        <div class="d-flex align-items-center">
                            <label for="taskCompletedDate" class="me-2" style="min-width: 150px;">Completed Date</label>
                            <input id="taskCompletedDate" class="form-control flex-grow-1" placeholder="Completed Date" type="text" readonly>
                        </div>
                    </div>
                </div>

                <!-- Activity Details -->
                <div class="p-1 mt-2">
                    <div class="row mb-1 p-0">
                        <div class="d-flex align-items-center">
                            <label for="taskActivity" class="me-2" style="min-width: 150px;">Task Activities</label>
                        </div>
                        <div id="taskActivityList" class="list-group">
                            <!-- This will be dynamically filled with activity details, with labels and inputs -->
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary">Submit</button>
            </div>
        </form>
    </div>
</div>

<!-- JavaScript to handle dropdown selection and update fields -->
<script>
    document.getElementById('taskDropdown').addEventListener('change', function () {
        var selectedOption = this.options[this.selectedIndex];

        // Update the task description and other fields
        document.getElementById('taskDescription').value = selectedOption.getAttribute('data-description');
        document.getElementById('taskState').value = selectedOption.getAttribute('data-state');
        document.getElementById('taskStartDate').value = selectedOption.getAttribute('data-start-date');
        document.getElementById('taskDueDate').value = selectedOption.getAttribute('data-due-date');
        document.getElementById('taskCompletedDate').value = selectedOption.getAttribute('data-completed-date') || '';

        // Update the task activity details
        var activities = JSON.parse(selectedOption.getAttribute('data-activities'));
        var activityList = document.getElementById('taskActivityList');
        activityList.innerHTML = ''; // Clear previous activities

        activities.forEach(function(activity, index) {
            var listItem = document.createElement('div');
            listItem.className = "mb-3";

            // Label for activity note
            var label = document.createElement('label');
            label.className = "form-label";
            label.textContent = "Activity " + (index + 1);

            // Input for activity note
            var input = document.createElement('input');
            input.type = "text";
            input.className = "form-control";
            input.value = activity;
            input.readOnly = true;

            listItem.appendChild(label);
            listItem.appendChild(input);
            activityList.appendChild(listItem);
        });
    });
</script>